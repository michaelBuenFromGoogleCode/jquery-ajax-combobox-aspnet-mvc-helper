(function(b){b.ajaxComboBox=function(g,c,a,d){function ea(a,b){ndx=-1;for(i=a.length-1;i>0;--i)if(a.charAt(i)=="."){ndx=i;break}return a.substring(0,ndx+1)+b+a.substring(ndx+1,a.length)}function E(){var c="#"+b(g).attr("id")+" ."+a.p_area_cls;b(c).length==1?b(c+" ."+a.p_del_cls).css("visibility","hidden"):b(c+" ."+a.p_del_cls).css("visibility","visible")}function F(c){x++;var K=b("<div></div>").addClass(a.p_area_cls),j=b("<div></div>"),s=b("<div></div>").addClass(a.p_del_cls);b("<img />").attr({alt:d.del_btn,
title:d.del_title,src:a.p_del_img1}).mouseover(function(c){b(c.target).attr("src",a.p_del_img2)}).mouseout(function(c){b(c.target).attr("src",a.p_del_img1)}).click(function(a){var c=a.target,a=b(g).find("input[type=text]").eq(0).attr("id");b(c).parent().parent().remove();c=b(g).find("input[type=text]").eq(0).attr("id");b("label[for="+a+"]").attr("for",c);E()}).appendTo(s);var G=b('<div style="clear:both"></div>');a.packagex?(j.addClass(a.p_acbox_cls),K.append(j).append(s).append(G),b(g).append(K).append(y),
j.width(H),b(g).width(H+s.width()),y.css("margin-left",j.width())):(K.append(j),b(g).append(K),j.width(b(g).width()));c.box=new S(j);E()}function S(c){function g(a){return a.replace(/^.|_./g,function(a){return a.replace(/_(.)/,"$1").toUpperCase()})}function j(b){var c=z(),b=c&&!b?c.offset().top:t.offset().top,d;a.sub_info?(d=q.children("table:visible"),d=d.height()+parseInt(d.css("border-top-width"),10)+parseInt(d.css("border-bottom-width"),10)):($(),d=L);var f=document.documentElement.clientHeight,
e=document.documentElement.scrollTop>0?document.documentElement.scrollTop:document.body.scrollTop,h=e+f-d,g;if(c.length)if(b<e||d>f)g=b-e;else if(b>h)g=b-h;else return;else b<e&&(g=b-e);window.scrollBy(0,g)}function s(){if(a.select_only)if(f.val()!=""){r.val()!=""?(e.attr("title",d.select_ok),e.children("img").attr({src:a.select_ok_img,alt:d.get_all_alt,title:d.select_ok})):(e.attr("title",d.select_ng),e.children("img").attr({src:a.select_ng_img,alt:d.get_all_alt,title:d.select_ng}));return}else r.val("");
e.attr("title",d.get_all_btn);e.children("img").attr({src:a.button_img,alt:d.get_all_alt,title:d.get_all_btn})}function G(){T=setTimeout(function(){now_value=f.val();now_value!=I&&(a.select_only&&(r.val(""),s()),o=1,k=!0,n());I=now_value;G()},500)}function F(){A=setTimeout(function(){M==!1&&u==!1&&v()},500)}function y(b){if(/27$|38$|40$|^9$/.test(b.keyCode)&&w.is(":visible")||/^37$|39$|13$|^9$/.test(b.keyCode)&&z()||/40$/.test(b.keyCode))switch(b.preventDefault&&b.preventDefault(),b.stopPropagation&&
b.stopPropagation(),b.cancelBubble=!0,b.returnValue=!1,b.keyCode){case 37:b.shiftKey?aa():ba();break;case 38:B=!0;(b=z())?(C(b.prev()),b.removeClass(a.select_class).prev().addClass(a.select_class)):(C(h.children("li:last-child"),h.children("li").length-1),h.children("li:last-child").addClass(a.select_class));j();break;case 39:b.shiftKey?ca():da();break;case 40:!w.is(":visible")&&!z()?(k=!1,n()):(B=!0,(b=z())?(C(b.next()),b.removeClass(a.select_class).next().addClass(a.select_class)):(C(h.children("li:first-child"),
0),h.children("li:first-child").addClass(a.select_class)),j());break;case 9:N=!0;v();break;case 13:U();break;case 27:N=!0,v()}else G()}function E(){e.children("img").attr("src",a.button_img);O=!1;V?e.mouseover():e.mouseout()}function H(){P&&(P.abort(),P=!1,E())}function n(){var c=k?b.trim(f.val()):"",Z=k?o:p;k&&c.length<a.minchars?v():(H(),q.children("table").css("display","none"),O=!0,e.attr("title",d.loading),e.children("img").attr({src:a.load_img,alt:d.loading_alt,title:d.loading}),b.globalEval("var xxx = "+
a.cascaded_word+";"),P=b.post(a.source,{cascaded_word:xxx,q_word:c,page_num:Z,per_page:a.per_page,field:a.field,show_field:a.show_field,hide_field:a.hide_field,select_field:J,order_field:a.order_field,order_by:a.order_by,primary_key:fa,db_table:a.db_table},function(d){if(d.candidate){d.cnt>d.cnt_page?S(d.cnt,d.cnt_page,Z):l.css("display","none");var f=[];b.each(d.candidate,function(b,d){f[b]=d.replace(RegExp(c,"ig"),function(b){return'<span class="'+a.match_class+'">'+b+"</span>"})});var e=[];d.attached?
b.each(d.attached,function(a,b){e[a]=b}):e=!1;var g=[];d.primary_key?b.each(d.primary_key,function(a,b){g[a]=b}):g=!1;ga(f,e,g)}else v();E();h.children("li:first-child").addClass(a.select_class);C(h.children("li:first-child"));j(!0)}))}function S(c,e,h){var g=a.per_page*(h-1)+1,e=d.page_info.replace("cnt",c).replace("num_page_top",g).replace("num_page_end",g+e-1);l.text(e);e=b("<p></p>");c=Math.ceil(c/a.per_page);k?Q=c:R=c;for(var m=h-Math.ceil((a.navi_num-1)/2),g=h+Math.floor((a.navi_num-1)/2);m<
1;)m++,g++;for(;g>c;)g--;for(;g-m<a.navi_num-1&&m>1;)m--;h==1?(a.navi_simple||b("<span></span>").text("<< 1").addClass("page_end").appendTo(e),b("<span></span>").text(d.prev).addClass("page_end").appendTo(e)):(a.navi_simple||b("<a></a>").attr({href:"javascript:void(0)","class":"navi_first"}).text("<< 1").attr("title",d.first_title).appendTo(e),b("<a></a>").attr({href:"javascript:void(0)","class":"navi_prev"}).text(d.prev).attr("title",d.prev_title).appendTo(e));for(i=m;i<=g;i++)m=i==h?'<span class="current">'+
i+"</span>":i,b("<a></a>").attr({href:"javascript:void(0)","class":"navi_page"}).html(m).appendTo(e);h==c?(b("<span></span>").text(d.next).addClass("page_end").appendTo(e),a.navi_simple||b("<span></span>").text(c+" >>").addClass("page_end").appendTo(e)):(b("<a></a>").attr({href:"javascript:void(0)","class":"navi_next"}).text(d.next).attr("title",d.next_title).appendTo(e),a.navi_simple||b("<a></a>").attr({href:"javascript:void(0)","class":"navi_last"}).text(c+" >>").attr("title",d.last_title).appendTo(e));
c>1&&(l.append(e).show(),b(".navi_first").mouseup(function(a){f.focus();a.preventDefault();aa()}),b(".navi_prev").mouseup(function(a){f.focus();a.preventDefault();ba()}),b(".navi_page").mouseup(function(a){f.focus();a.preventDefault();k?o=parseInt(b(this).text(),10):p=parseInt(b(this).text(),10);n()}),b(".navi_next").mouseup(function(a){f.focus();a.preventDefault();da()}),b(".navi_last").mouseup(function(a){f.focus();a.preventDefault();ca()}))}function aa(){k?o>1&&(o=1,n()):p>1&&(p=1,n())}function ba(){k?
o>1&&(o--,n()):p>1&&(p--,n())}function da(){k?o<Q&&(o++,n()):p<R&&(p++,n())}function ca(){k?o<Q&&(o=Q,n()):p<R&&(p=R,n())}function ga(c,f,g){if(c.length==0)v();else{h.empty();q.empty();for(var j=0;j<c.length;j++){var m=b("<li>"+c[j]+"</li>");a.select_only&&m.attr("id",g[j]);h.append(m);if(f){for(var m=b("<table><tbody></tbody></table>"),k=0;k<f[j].length;k++){var n=a.sub_as[f[j][k][0]]!=null?a.sub_as[f[j][k][0]]:f[j][k][0],l=b("<tr></tr>");l.append("<th>"+n+"</th>");l.append("<td>"+f[j][k][1]+"</td>");
m.children("tbody").append(l)}q.append(m)}}f&&q.insertAfter(h);w.show().width(t.width()+parseInt(t.css("border-left-width"))+parseInt(t.css("border-right-width")));h.children("li").mouseover(function(){B?B=!1:(C(this),h.children("li").removeClass(a.select_class),b(this).addClass(a.select_class))}).mousedown(function(){u=!0;clearTimeout(A)}).mouseup(function(a){u=!1;B?B=!1:(a.preventDefault(),a.stopPropagation(),U())});e.attr("title",d.close_btn);e.children("img").attr({src:a.load_img,alt:d.close_alt,
title:d.close_btn})}}function z(){if(!w.is(":visible"))return!1;var b=h.children("li."+a.select_class);b.length||(b=!1);return b}function U(){j(!0);var c=z();c&&(f.val(c.text()),v(),I=f.val(),a.select_only&&(r.val(c.attr("id")),s()),a.on_selected!=void 0&&b.globalEval(a.on_selected));f.change();r.valid()}function v(){N&&(j(!0),N=!1);w.hide();q.children("table").css("display","none");H();s()}function $(){L==null&&($obj=h.children("li:first"),L=$obj.height()+parseInt($obj.css("border-top-width"),10)+
parseInt($obj.css("border-bottom-width"),10)+parseInt($obj.css("padding-top"),10)+parseInt($obj.css("padding-bottom"),10))}function C(c,d){if(a.sub_info&&(W==null&&(W=parseInt(h.css("border-top-width"),10)),X==null&&(X=l.height()+parseInt(l.css("border-top-width"),10)+parseInt(l.css("border-bottom-width"),10)+parseInt(l.css("padding-top"),10)+parseInt(l.css("padding-bottom"),10)),$(),Y==null&&(Y=h.width()+parseInt(h.css("padding-left"),10)+parseInt(h.css("padding-right"),10)+parseInt(h.css("border-left-width"),
10)+parseInt(h.css("border-right-width"),10)),d==null&&(d=h.children("li").index(c)),q.children("table").css("display","none"),d>-1)){var e=0;l.css("display")!="none"&&(e+=X);e+=W+L*d;var f=Y;b.browser.mozilla&&(e++,f++);e+="px";f+="px";q.children("table:eq("+d+")").css({position:"absolute",top:e,left:f,display:b.browser.msie?"block":"table"})}}this.hidden=this.input=null;this.resetPage=function(){p=1};b.ajaxSetup({cache:!1});var M=!1,A=!1,T=!1,k=!1,p=1,o=1,R=1,Q=1,O=!1,V=!1,u=!1,P=!1,N=!1,B=!1,I=
"",X=null,W=null,L=null,Y=null,J;a.sub_info?J=a.show_field&&!a.hide_field?a.field+","+a.show_field:"*":(J=a.field,a.hide_field="");a.select_only&&J!="*"&&(J+=","+a.primary_key);var fa=a.select_only?a.primary_key:"";b(c).addClass(a.combo_class);var t=b('<table cellspacing="1"><tbody><tr><th></th><td></td></tr></tbody></table>').addClass(a.table_class),f=b("<input />").attr({type:"text",autocomplete:"off"}).addClass(a.input_class);this.input=f;if(a.cake_rule){var D=g(a.cake_field);a.packagex?f.attr({name:"data["+
a.cake_model+"]["+a.cake_field+"]["+(x-1)+"]",id:a.cake_model+D+(x-1)}):f.attr({name:"data["+a.cake_model+"]["+a.cake_field+"]",id:a.cake_model+D})}else f.attr({name:ea(a.the_field_name,"txt_"),id:"txt_"+a.the_field_id});var D=t.children("tbody").children("tr").children("th"),e=t.children("tbody").children("tr").children("td");e.append("<img />");var w=b("<div></div>").addClass(a.re_area_class),l=b("<div></div>").addClass(a.navi_class),h=b("<ul></ul>").addClass(a.results_class),q=b("<div></div>").addClass(a.sub_info_class),
r=b('<input type="hidden" />').attr({name:a.the_field_name,id:a.the_field_id}).val("");this.hidden=r;r.attr(a.other_attr);s();D.append(f);w.append(l).append(h);b(c).append(t).append(w);a.select_only&&b(c).append(r);f.width(b(c).width()-e.children("img").width()-parseInt(D.css("padding-left"))-parseInt(D.css("padding-right"))-parseInt(e.css("padding-left"))-parseInt(e.css("padding-right"))-parseInt(e.css("border-left-width"))-parseInt(e.css("border-right-width"))-parseInt(t.css("border-left-width"))-
parseInt(t.css("border-right-width"))-3);(function(){a.init_val!==!1&&(a.select_only?(r.val(a.init_val[x-1]),b.post(a.init_src,{q_word:a.init_val[x-1],field:a.field,primary_key:a.primary_key,db_table:a.db_table},function(b){f.val(b);I=b;e.attr("title",d.select_ok);e.children("img").attr({src:a.select_ok_img,alt:d.get_all_alt,title:d.select_ok})})):(I=a.init_val[x-1],f.val(a.init_val[x-1])))})();e.mouseup(function(a){w.css("display")=="none"?(clearInterval(T),k=!1,n(),f.focus()):v();a.stopPropagation()});
e.mouseover(function(){V=!0;O||e.css("background-image","url("+a.ac_btn_on_img+")").addClass(a.btn_on_class).removeClass(a.btn_out_class)});e.mouseout(function(){V=!1;O||e.css("background-image","url("+a.ac_btn_out_img+")").addClass(a.btn_out_class).removeClass(a.btn_on_class)});e.mouseout();b.support.checkOn&&b.support.cssFloat?f.keypress(y):f.keydown(y);f.focus(function(){M=!0;G()});f.blur(function(){h.children("li").length==1&&h.children("li:first").text()==b.trim(f.val())&&U();clearTimeout(T);
M=!1;F();s();r.valid()});f.mousedown(function(a){u=!0;clearTimeout(A);a.stopPropagation()});f.mouseup(function(a){f.focus();u=!1;a.stopPropagation()});l.mousedown(function(a){u=!0;clearTimeout(A);a.stopPropagation()});l.mouseup(function(a){f.focus();u=!1;a.stopPropagation()});q.mousedown(function(a){u=!0;clearTimeout(A);a.stopPropagation()});q.mouseup(function(a){f.focus();u=!1;a.stopPropagation()});b("body").mouseup(function(){clearTimeout(A);M=!1;v()})}this.box=null;this.clearValue=function(){this.box.input.val("");
this.box.hidden.val("");this.box.resetPage()};var x=0,H=b(g).width(),y=b("<div></div>").addClass(a.p_add_cls);a.packagex&&b("<img />").attr({alt:d.add_btn,title:d.add_title,src:a.p_add_img1}).mouseover(function(c){b(c.target).attr("src",a.p_add_img2)}).mouseout(function(c){b(c.target).attr("src",a.p_add_img1)}).click(function(){F(this,g)}).appendTo(y);if(a.init_val===!1)F(this,g);else{for(i=0;a.init_val.length>i;i++)F(this,g);a.init_val=!1}};b.fn.ajaxComboBox=function(g,c){if(g){c=b.extend({source:g,
db_table:"tbl",img_dir:"/Scripts/acbox/img/",field:"name",minchars:1,per_page:10,navi_num:5,navi_simple:!1,init_val:!1,init_src:"/TheJson/InitVal/",the_field_name:b(this).attr("id").replace(/_/g,"."),the_field_id:b(this).attr("id"),mini:!1,lang:"ja",sub_info:!1,sub_as:{},show_field:"",hide_field:"",select_only:!1,primary_key:"id"},c);c=b.extend({order_field:c.field,order_by:"ASC",packagex:!1,p_del_img1:c.img_dir+"del_out.png",p_del_img2:c.img_dir+"del_over.png",p_add_img1:c.img_dir+"add_out.png",
p_add_img2:c.img_dir+"add_over.png",cake_rule:!1,cake_model:c.db_table,cake_field:c.field,p_area_cls:"box_area"+(c.mini?"_mini":""),p_acbox_cls:"combo_box"+(c.mini?"_mini":""),p_add_cls:"add_area"+(c.mini?"_mini":""),p_del_cls:"del_area"+(c.mini?"_mini":""),combo_class:"ac_combobox_area"+(c.mini?"_mini":""),table_class:"ac_table"+(c.mini?"_mini":""),input_class:"ac_input"+(c.mini?"_mini":""),button_class:"ac_button"+(c.mini?"_mini":""),btn_on_class:"ac_btn_on"+(c.mini?"_mini":""),btn_out_class:"ac_btn_out"+
(c.mini?"_mini":""),re_area_class:"ac_result_area"+(c.mini?"_mini":""),navi_class:"ac_navi"+(c.mini?"_mini":""),results_class:"ac_results"+(c.mini?"_mini":""),select_class:"ac_over"+(c.mini?"_mini":""),match_class:"ac_match"+(c.mini?"_mini":""),sub_info_class:"ac_attached"+(c.mini?"_mini":""),button_img:c.img_dir+"combobox_button"+(c.mini?"_mini":"")+".png",load_img:c.img_dir+"ajax-loader"+(c.mini?"_mini":"")+".gif",select_ok_img:c.img_dir+"select_ok"+(c.mini?"_mini":"")+".png",select_ng_img:c.img_dir+
"select_ng"+(c.mini?"_mini":"")+".png",ac_btn_on_img:c.img_dir+"btn_on"+(c.mini?"_mini":"")+".png",ac_btn_out_img:c.img_dir+"btn_out"+(c.mini?"_mini":"")+".png"},c);switch(c.lang){case "ja":var a={add_btn:"\u8ffd\u52a0\u30dc\u30bf\u30f3",add_title:"\u5165\u529b\u30dc\u30c3\u30af\u30b9\u3092\u8ffd\u52a0\u3057\u307e\u3059",del_btn:"\u524a\u9664\u30dc\u30bf\u30f3",del_title:"\u5165\u529b\u30dc\u30c3\u30af\u30b9\u3092\u524a\u9664\u3057\u307e\u3059",next:"\u6b21\u3078",next_title:"\u6b21\u306e"+c.per_page+
"\u4ef6 (\u53f3\u30ad\u30fc)",prev:"\u524d\u3078",prev_title:"\u524d\u306e"+c.per_page+"\u4ef6 (\u5de6\u30ad\u30fc)",first_title:"\u6700\u521d\u306e\u30da\u30fc\u30b8\u3078 (Shift + \u5de6\u30ad\u30fc)",last_title:"\u6700\u5f8c\u306e\u30da\u30fc\u30b8\u3078 (Shift + \u53f3\u30ad\u30fc)",get_all_btn:"\u5168\u4ef6\u53d6\u5f97 (\u4e0b\u30ad\u30fc)",get_all_alt:"\u753b\u50cf:\u30dc\u30bf\u30f3",close_btn:"\u9589\u3058\u308b (Tab\u30ad\u30fc)",close_alt:"\u753b\u50cf:\u30dc\u30bf\u30f3",loading:"\u30ed\u30fc\u30c9\u4e2d...",
loading_alt:"\u753b\u50cf:\u30ed\u30fc\u30c9\u4e2d...",page_info:"num_page_top - num_page_end \u4ef6 (\u5168 cnt \u4ef6)",select_ng:"\u6ce8\u610f : \u30ea\u30b9\u30c8\u306e\u4e2d\u304b\u3089\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044",select_ok:"OK : \u6b63\u3057\u304f\u9078\u629e\u3055\u308c\u307e\u3057\u305f\u3002"};break;case "en":a={add_btn:"Add button",add_title:"add a box",del_btn:"Del button",del_title:"delete a box",next:"Next",next_title:"Next"+c.per_page+" (Right key)",prev:"Prev",
prev_title:"Prev"+c.per_page+" (Left key)",first_title:"First (Shift + Left key)",last_title:"Last (Shift + Right key)",get_all_btn:"Get All (Down key)",get_all_alt:"(button)",close_btn:"Close (Tab key)",close_alt:"(button)",loading:"loading...",loading_alt:"(loading)",page_info:"num_page_top - num_page_end of cnt",select_ng:"Attention : Please choose from among the list.",select_ok:"OK : Correctly selected."};break;case "es":a={add_btn:"Agregar boton",add_title:"Agregar una opcion",del_btn:"Borrar boton",
del_title:"Borrar una opcion",next:"Siguiente",next_title:"Proximas "+c.per_page+" (tecla derecha)",prev:"Anterior",prev_title:"Anteriores "+c.per_page+" (tecla izquierda)",first_title:"Primera (Shift + Left)",last_title:"Ultima (Shift + Right)",get_all_btn:"Ver todos (tecla abajo)",get_all_alt:"(boton)",close_btn:"Cerrar (tecla TAB)",close_alt:"(boton)",loading:"Cargando...",loading_alt:"(Cargando)",page_info:"num_page_top - num_page_end de cnt",select_ng:"Atencion: Elija una opcion de la lista.",
select_ok:"OK: Correctamente seleccionado."}}var d=null;this.each(function(){d=new b.ajaxComboBox(this,g,c,a)});this.data("ajc",d);return this}};b.fn.ajc=function(){return this.data("ajc")}})(jQuery);